{% extends 'Layout 1 Column' %}
{% block main %}
  {% include 'Page Copy' %}
<div class="container" role="main">
   <!-- {% include 'Child Navigation' showdescriptions: true %} -->

    {% if page.adx_entitylist %}
    {% include 'entity_list' key: page.adx_entitylist.id %}
    {% endif %}

    {% if page.adx_entityform %}
    {% entityform id: page.adx_entityform.id %}
    {% endif %}

    {% if page.adx_webform %}
    {% webform id: page.adx_webform.id %}
    {% endif %}
</div>

<script>
  $(document).ready(function() {
      //$("<td style='width: 50% !important; float: right; margin-top: -40px !important;padding-bottom: 0px !important; margin-bottom: 0px !important;'><button class='btn btn-primary button' onclick=>Book an Appointment</button></td>").insertAfter('td[data-th="Doctor"]'); //add button
      //$('.entity-grid').before('<span style="background-color: yellow; font-style: italic"><p style="background-color: yellow;">This form is under construction</p></span>');
    
  });


 

  $(".entitylist.entity-grid").on("loaded", function () {
    $("#dropdown_0").change(onPrimaryChange);
    $("#dropdown_1").change(onPrimaryChange);
    // $("#dropdown_0").change();
    // $("#dropdown_1").change();
    
    function onPrimaryChange()
    {
        $('button[data-target="#EntityList9b553251-3aa2-eb11-b1ac-000d3a55ac4e"]').click();
    }

    $('button[data-target="#EntityList9b553251-3aa2-eb11-b1ac-000d3a55ac4e"]').hide();// hide apply filter button

    $('td[aria-label="action menu"]').hide();// hide oob view button
    
    
    //$('div[class="pull-right toolbar-actions"]').prependTo(".entitylist");
    $('input[class="query form-control"]').attr('placeholder',"Search for Specialty, Hospital name or your Doctor's name"); //relabel place holder
    //$('div[class="pull-right toolbar-actions"]').appendTo("#entitylist-filters");
    $('#EntityList9b553251-3aa2-eb11-b1ac-000d3a55ac4e').appendTo('div[class="view-toolbar grid-actions clearfix"]');

    
    //check if appointment type is yes
    //$('td[aria-label="E-Consultation Yes"]').prepend('<div style="color: #5BBA47;"><h5>Consultation</h5></div>');
    $('td[aria-label="E-Consultation Yes"]').html("E-Consultation"); // E-consultation
    $('td[aria-label="E-Consultation No"]').html(""); // E-consultation
    
    $('td[aria-label="Face to Face Yes"]').html("Face to Face"); // Face to face
    $('td[aria-label="Face to Face No"]').html(""); // Face to face

    //add header 

    $('td[data-th="Hospital"]').prepend('<div style="color: #5BBA47;"><h5>Associated Hospital</h5></div>'); // to hospital
    $('td[data-th="E-Consultation"]').prepend('<div style="color: #5BBA47;"><h5>Consultation</h5></div>'); // to econsult
    //$('<div style="color: #5BBA47;"><h5>Consultation</h5></div>').prependTo('td[data-th="E-Consultation"]'); // to econsult
    //$('td[aria-label="E-Consultation Yes"]').prepend('<div style="color: #5BBA47;"><h5>Consultation</h5></div>');
    //$('<div style="color: #5BBA47;"><h5>Consultation</h5></div>').prependTo('td[data-attribute="mphhi_econsultation"]'); // to econsult
    $('tr').append('<td data-type="System.Boolean"  data-value="true" ></td>'); // extra space for bottom

    //$('td[data-th="E-Consultation"]').prepend('<div style="color: #5BBA47;"><h5>Consultation</h5></div>');
    //$('td:nth-child(5)').prepend('<div style="color: #5BBA47;"><h5>Consultation</h5></div>'); 

    // if(($('td[aria-label="E-Consultation Yes"]') == true) && ($('td[aria-label="Face to Face No"]') == true))
    // {
    //     $('td[aria-label="E-Consultation Yes"]').html("E-Consultation"); // E-consultation
    //     $('td[aria-label="E-Consultation Yes"]').prepend('<div class="Consultation" style="color: #5BBA47;"><h5>Consultation</h5></div>');

    //     $('td[aria-label="Face to Face No"]').html(""); // Hide Face to face
    // }
    // if(($('td[aria-label="E-Consultation No"]') == true) && ($('td[aria-label="Face to Face Yes"]') == true))
    // {
    //     $('td[aria-label="Face to Face Yes"]').html("Face to Face"); // Face to face
    //     $('td[aria-label="Face to Face Yes"]').prepend('<div class="Consultation" style="color: #5BBA47;"><h5>Consultation</h5></div>');

    //     $('td[aria-label="E-Consultation No"]').html(""); // Face to face
    // }

    
    //$("tr[data-entity='mphhi_associatedhospital']").append("<td class='book-doctor-container'><a class='btn btn-primary button' href=''>View</a></td>");
    $(".book-doctor-container").on('click', function () {
      var row = $(this).closest('tr');
      var trID = row.attr('data-id');
      var trName = row.attr('data-name');
      var href = "https://mphhi-dev-us.powerappsportals.com/find-a-doctor/find-a-doctor-view/?id={{trID}}";

      $('.book-doctor-container').attr("href", href);
    });
    // get cardiologist data name, guid, entityname 
		var column = row.find("td[data-attribute='mphhi_hospital']");
		var specializationData = column.attr("data-value");
    var splitSpecialization = specializationData.split(/[^A-Za-z0-9,-\s]/);
    var specializationName = splitSpecialization[16];
    var specializationGUID = splitSpecialization[5];
    var specializationEntityName = "mphhi_department";

    console.log(`${specializationName} ${specializationGUID} ${specializationEntityName}`);


		// get hospital data name, guid, entityname
		var column = row.find("td[data-attribute='mphhi_hospital']");
		var hospitalData = column.attr("data-value");
    var splitHospital = hospitalData.split(/[^A-Za-z0-9,-\s]/);
    var hospitalName = splitHospital[16];
    var hospitalGUID = splitHospital[5];
    var hospitalEntityName = "msemr_location";

    console.log(`${hospitalName} ${hospitalGUID} ${hospitalEntityName}`);
		
		// get Associated Hospital name, guid, entityname
		var row = $(this).closest("td[data-attribute='mphhi_hospital']");
		var aHospitalName = row.attr('data-name');
    var aHospitalGUID = row.attr('data-id');
    var aHospitalEntityName = "mphhi_associatedhospital";

 
		// $(".book-doctor-container").on('click', function () {
		// 	var row = $(this).closest("tr");
		// 	var column = row.find("td[data-attribute='mphhi_hospital']");
		// 	var specializationData2 = column.attr("data-value");
    //   console.log(specializationData2);
    // });

    
    //$("<td class='book-doctor-container' style='width: 50% !important; float: right; margin-top: -40px !important;padding-bottom: 0px !important; margin-bottom: 0px !important;'></td>").insertAfter('td[data-th="Doctor"]'); //add button
    //$("<td style='width: 50% !important; float: right; margin-top: -40px !important;padding-bottom: 0px !important; margin-bottom: 0px !important;'></td>").insertAfter('td[data-th="Doctor"]'); //add button
    //$('a[class="details-link"][title="View details"]').prependTo(".button");
    //$('a[class="details-link"][title="View details"]').prependTo(".button");
    //$('td:nth-child(5)').prependTo("td:nth-child(2)");
    $(this).children(".view-grid").find("ul").each(function (){
        var row = $(this).closest('tr');
        var trID = row.attr('data-id');
        var trName = row.attr('data-name');
        //var href = "https://mphhi-dev-us.powerappsportals.com/find-a-doctor/find-a-doctor-view/?id={{trID}}";
        
        //$('.book-doctor-container').attr("href", href);
        $("tr[data-id='"+trID+"']").find('td[data-th="Doctor"]').attr("id", trID);
        //$("tr[data-id='"+trID+"']").append("<td class='book-doctor-container'><a class='btn btn-primary button' href='https://mphhi-dev-us.powerappsportals.com/find-a-doctor/find-a-doctor-view/?id="+trID+"'>View</a></td>");
        
        $("<td id='tdbutton"+trID+"' class='book-doctor-container' style='position: relative; height: 40px; width: 14%; padding: 10px !important; width: 20% !important; margin-left: 29%;'></td>").insertAfter('td[id="'+trID+'"]'); //add button
$("td[id='tdbutton"+trID+"']").append("<a class='btn btn-primary button' href='https://mphhi-dev-us.powerappsportals.com/new-appointment-web-form/?hid="+hospitalGUID+"&hname="+hospitalName+"&hename="+hospitalEntityName+"&sid="+specializationGUID+"&sname="+specializationName+"&sename="+specializationEntityName+"&aid="+trID+"&aname="+trName+"&aename"+aHospitalEntityName+"'>Book</a>");
        
        //$("<a class='btn btn-primary button' href='https://mphhi-dev-us.powerappsportals.com/find-a-doctor/find-a-doctor-view/?id="+trID+"'>View</a>").insertAfter('td[data-th="Doctor"]');
        // do something with each row
        //$('td:nth-child(5)').css("position","");
        //$(this).prependTo("td:nth-child(2)");
        //$('td:nth-child(5)').prependTo("td:nth-child(2)");
        //$( 'td[data-th="Doctor"]' ).clone().prependTo("td:nth-child(2)");
    });
  });
</script>
{% if user | has_role:"Anonymous Users" %}
  <script>
    $('a[href="/corporate-appointments/"][role="menuitem"]').hide(); // hide corporate appointments in header 
  </script> 

{% elsif user | has_role:"Authenticated Users" %}

  <script>
    $('a[href="/corporate-appointments/"][role="menuitem"]').hide(); // hide corporate appointments in header 
  </script> 

  {% elsif user | has_role:"Corporate Representative" %}
  <script>
    $('a[class="weblink list-group-item"][href="/profile/profile-my-appointments/"][title="Appointments"][aria-label="Appointments"]').hide(); //hide appointments
        $('a[class="weblink list-group-item"][href="/profile/profile-my-medical-histories/"][title="Medical History"][aria-label="Medical History"]').hide(); //hide medical history
        $('a[class="weblink list-group-item"][href="/guarantors/"][title="Guarantors"][aria-label="Guarantors"]').hide(); //hide guarantors
        $('a[class="weblink list-group-item"][aria-label="Manage My Dependents"]').hide(); //hide dependents weblink
        $('a[href="/dependents/"][role="menuitem"][aria-label="Manage My Dependents"]').hide(); // hide dependents in header dropdown
        $('a[href="/my-appointments/dependents-appointments/"][role="menuitem"]').hide(); // hide dependents appointments in header dropdown
        $('a[title="Appointments"][class="dropdown-toggle"][role="menuitem"]').hide(); // hide appointments in header 
        $('a[href="/pharmacy-orders/"][role="menuitem"]').hide(); // hide appointments in header 
  </script>

{% else %}


{% endif %}

{% endblock %}